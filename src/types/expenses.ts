// > [IA] - v1.4.0: Sistema de Gastos de Caja - Types y validaciones
// Previous: N/A (archivo nuevo)
// Objetivo: Definir interfaces, types, guards y constantes para gestiÔøΩn de gastos operacionales

/**
 * @fileoverview Sistema de Gastos de Caja - Definiciones TypeScript
 * @module types/expenses
 * @version 1.4.0
 *
 * @description
 * Este mÔøΩdulo define los tipos TypeScript para el sistema de registro de gastos operacionales.
 * Los gastos se registran ANTES del conteo de caja (Step 6 del wizard) y afectan el cÔøΩlculo final.
 *
 * @compliance REGLAS_DE_LA_CASA.md
 * - Zero `any` types (lÔøΩnea 85-90)
 * - 100% test coverage para lÔøΩgica financiera
 * - TSDoc completo en todas las interfaces pÔøΩblicas
 *
 * @see /Documentos_MarkDown/Planes_de_Desarrollos/Caso_Gastos_Caja/Fase_1_Tipos_TypeScript.md
 */

/**
 * Representa un gasto operacional del d√≠a registrado ANTES del conteo de caja.
 *
 * @remarks
 * Los gastos se registran en Step 6 del InitialWizardModal (despu√©s de ingresar venta esperada SICAR,
 * antes de iniciar el conteo f√≠sico de denominaciones).
 *
 * **Impacto en C√°lculos Financieros:**
 * - Ecuaci√≥n original: `difference = totalGeneral - expectedSales`
 * - Ecuaci√≥n con gastos: `totalAdjusted = totalGeneral - totalExpenses`
 * - Diferencia final: `difference = totalAdjusted - expectedSales`
 *
 * **Compliance Fiscal:**
 * - Campo `hasInvoice` obligatorio para auditor√≠a
 * - Timestamp ISO 8601 para trazabilidad completa
 * - Monto con m√°ximo 2 decimales (validaci√≥n USD)
 *
 * **Persistencia:**
 * - Almacenado en localStorage bajo key `cashguard_daily_expenses`
 * - Limpieza autom√°tica al completar Phase 3 (reporte final)
 * - Serializaci√≥n/deserializaci√≥n con `JSON.stringify()`/`JSON.parse()`
 *
 * @example
 * ```typescript
 * const expense: DailyExpense = {
 *   id: crypto.randomUUID(),
 *   concept: "Suministros de limpieza",
 *   amount: 15.50,
 *   category: "supplies",
 *   hasInvoice: true,
 *   timestamp: new Date().toISOString()
 * };
 * ```
 *
 * @see ExpenseCategory Para lista completa de categor√≠as v√°lidas
 * @see isDailyExpense Para validaci√≥n runtime de objetos
 * @see EXPENSE_VALIDATION Para l√≠mites de validaci√≥n
 */
export interface DailyExpense {
  /**
   * Identificador √∫nico del gasto (UUID v4).
   *
   * @remarks
   * Generado con `crypto.randomUUID()` para garantizar unicidad global.
   * No reutilizable entre sesiones (cada registro nuevo requiere nuevo UUID).
   *
   * @example "a1b2c3d4-e5f6-47a8-b9c0-d1e2f3a4b5c6"
   */
  id: string;

  /**
   * Descripci√≥n textual del gasto (3-100 caracteres).
   *
   * @remarks
   * - Debe ser descriptiva y concisa (ej: "Transporte urgente proveedor", "Papel higi√©nico")
   * - Aparece en reporte WhatsApp final
   * - Validaci√≥n: longitud m√≠nima 3 caracteres, m√°xima 100 caracteres
   *
   * @example "Suministros de limpieza"
   * @example "Reparaci√≥n caja registradora"
   */
  concept: string;

  /**
   * Monto del gasto en USD (0.01 - 10,000.00).
   *
   * @remarks
   * - Debe ser positivo (> 0)
   * - M√°ximo 2 decimales (validaci√≥n USD)
   * - Rango permitido: $0.01 - $10,000.00
   * - Afecta directamente el c√°lculo: `totalAdjusted = totalGeneral - sum(expenses)`
   *
   * @example 15.50  // V√°lido
   * @example 0.01   // V√°lido (m√≠nimo)
   * @example 10000  // V√°lido (m√°ximo)
   * @example 0      // ‚ùå Inv√°lido (debe ser > 0)
   * @example 15.555 // ‚ùå Inv√°lido (m√°s de 2 decimales)
   */
  amount: number;

  /**
   * Categor√≠a del gasto para clasificaci√≥n y reporter√≠a.
   *
   * @remarks
   * Usado para:
   * - Agrupaci√≥n en reporte WhatsApp
   * - An√°lisis de gastos por categor√≠a
   * - Emojis visuales en UI (ver EXPENSE_CATEGORY_EMOJI)
   *
   * @see ExpenseCategory Para lista completa de valores v√°lidos
   */
  category: ExpenseCategory;

  /**
   * Indica si el gasto tiene factura f√≠sica (compliance fiscal).
   *
   * @remarks
   * - `true`: Gasto tiene factura respaldatoria
   * - `false`: Gasto sin factura (puede requerir justificaci√≥n)
   * - Reportado en secci√≥n de gastos con emoji visual (üìÑ/‚ùå)
   * - Cr√≠tico para auditor√≠as contables
   */
  hasInvoice: boolean;

  /**
   * Timestamp de registro en formato ISO 8601 (zona UTC).
   *
   * @remarks
   * - Generado con `new Date().toISOString()`
   * - Formato: "YYYY-MM-DDTHH:mm:ss.sssZ"
   * - Usado para:
   *   - Ordenamiento cronol√≥gico en reporte
   *   - Correlaci√≥n con video vigilancia (CCTV)
   *   - Trazabilidad completa de auditor√≠a
   *
   * @example "2025-10-13T19:45:32.123Z"
   */
  timestamp: string;
}

/**
 * Categor√≠as de gastos operacionales para clasificaci√≥n y reporter√≠a.
 *
 * @remarks
 * Se usa union type (en lugar de enum) por las siguientes razones t√©cnicas:
 * - **Tree-shaking:** Union types no generan c√≥digo JavaScript adicional
 * - **Type safety:** TypeScript valida en compile-time, no runtime
 * - **Immutability:** Valores literales no pueden ser modificados
 * - **Pattern moderno:** Recomendado por TypeScript team (2020+)
 *
 * **Uso en UI:**
 * - Cada categor√≠a tiene emoji asociado (ver EXPENSE_CATEGORY_EMOJI)
 * - Labels en espa√±ol (ver EXPENSE_CATEGORY_LABEL)
 * - Colores visuales por severidad (operational = azul, supplies = verde, etc.)
 *
 * **Reporte WhatsApp:**
 * ```
 * üí∞ GASTOS DEL D√çA ($45.50):
 *
 * ‚öôÔ∏è Operacional: $20.00
 *    ‚Ä¢ Reparaci√≥n urgente caja registradora ($20.00) üìÑ
 *
 * üßπ Suministros: $15.50
 *    ‚Ä¢ Papel higi√©nico y jab√≥n ($15.50) ‚ùå
 *
 * üìã Otros: $10.00
 *    ‚Ä¢ Varios menores ($10.00) üìÑ
 * ```
 *
 * @example
 * ```typescript
 * const category: ExpenseCategory = 'operational'; // ‚úÖ V√°lido
 * const invalid: ExpenseCategory = 'invalid';      // ‚ùå Error TypeScript
 * ```
 */
// ü§ñ [IA] - v2.5: Categor√≠as personalizadas Paradise Acuarios
export type ExpenseCategory =
  | 'employees'        // üí∞ Empleados (pagos, adelantos, semanales)
  | 'supplies'         // üì¶ Insumos Operativos (bolsas, materiales despacho)
  | 'maintenance'      // üîß Mantenimiento (ferreter√≠a, reparaciones)
  | 'shipping'         // üöö Env√≠os (encomendistas, delivery)
  | 'small_purchases'  // üõí Compras Menores (proveedores peque√±os)
  | 'other';           // üìã Otros (imprevistos varios)

/**
 * Type guard para validar si un objeto desconocido es un DailyExpense v√°lido en runtime.
 *
 * @remarks
 * Esta funci√≥n es CR√çTICA para:
 * - **Deserializaci√≥n localStorage:** Validar datos antes de `JSON.parse()`
 * - **API boundaries:** Validar datos provenientes de fuentes externas
 * - **Type narrowing:** Permitir a TypeScript inferir tipo correcto
 * - **Error prevention:** Detectar datos corruptos antes de usarlos
 *
 * **Validaciones Implementadas:**
 * 1. ‚úÖ Estructura b√°sica (6 propiedades con tipos correctos)
 * 2. ‚úÖ Categor√≠a dentro de valores v√°lidos (5 literales)
 * 3. ‚úÖ Monto positivo y no NaN
 * 4. ‚úÖ Timestamp v√°lido ISO 8601 (parseable con `new Date()`)
 *
 * **Pattern:**
 * ```typescript
 * function myFunc(obj: unknown): void {
 *   if (isDailyExpense(obj)) {
 *     // TypeScript sabe que obj es DailyExpense aqu√≠
 *     console.log(obj.concept); // ‚úÖ V√°lido
 *   }
 * }
 * ```
 *
 * **Ejemplo localStorage:**
 * ```typescript
 * const stored = localStorage.getItem('cashguard_daily_expenses');
 * if (stored) {
 *   const parsed = JSON.parse(stored);
 *   if (Array.isArray(parsed) && parsed.every(isDailyExpense)) {
 *     // ‚úÖ Todos los elementos son DailyExpense v√°lidos
 *     const expenses: DailyExpense[] = parsed;
 *   }
 * }
 * ```
 *
 * @param obj - Objeto desconocido a validar
 * @returns `true` si el objeto es un DailyExpense v√°lido, `false` en caso contrario
 *
 * @see DailyExpense Para estructura completa del interface
 * @see EXPENSE_VALIDATION Para constantes de validaci√≥n usadas
 */
export function isDailyExpense(obj: unknown): obj is DailyExpense {
  // Validaci√≥n nivel 1: Verificar que es un objeto no-null
  if (typeof obj !== 'object' || obj === null) {
    return false;
  }

  // Type assertion segura despu√©s de validar que es objeto
  const expense = obj as Record<string, unknown>;

  // Validaci√≥n nivel 2: Verificar presencia y tipo de TODAS las propiedades requeridas
  if (typeof expense.id !== 'string') return false;
  if (typeof expense.concept !== 'string') return false;
  if (typeof expense.amount !== 'number') return false;
  if (typeof expense.category !== 'string') return false;
  if (typeof expense.hasInvoice !== 'boolean') return false;
  if (typeof expense.timestamp !== 'string') return false;

  // Validaci√≥n nivel 3: Verificar que category es uno de los valores v√°lidos
  // ü§ñ [IA] - v2.5: Categor√≠as actualizadas Paradise Acuarios
  const validCategories: ExpenseCategory[] = [
    'employees',
    'supplies',
    'maintenance',
    'shipping',
    'small_purchases',
    'other'
  ];
  if (!validCategories.includes(expense.category as ExpenseCategory)) {
    return false;
  }

  // Validaci√≥n nivel 4: Verificar que amount es positivo y no NaN
  if (expense.amount <= 0 || isNaN(expense.amount)) {
    return false;
  }

  // Validaci√≥n nivel 5: Verificar que timestamp es ISO 8601 v√°lido
  const date = new Date(expense.timestamp);
  if (isNaN(date.getTime())) {
    return false;
  }

  // ‚úÖ Todas las validaciones pasaron - objeto es DailyExpense v√°lido
  return true;
}

/**
 * Constantes de validaci√≥n para campos de DailyExpense.
 *
 * @remarks
 * Usado en:
 * - Formularios UI (validaci√≥n client-side)
 * - Type guard `isDailyExpense()` (validaci√≥n runtime)
 * - Tests (casos edge y boundary testing)
 *
 * **Justificaci√≥n de L√≠mites:**
 * - `MIN_CONCEPT_LENGTH = 3`: Evita inputs vac√≠os o demasiado vagos ("Xyz")
 * - `MAX_CONCEPT_LENGTH = 100`: Balance entre descriptividad y brevedad reporte
 * - `MIN_AMOUNT = 0.01`: Monto m√≠nimo representable en USD (1 centavo)
 * - `MAX_AMOUNT = 10000`: L√≠mite razonable gastos operacionales diarios (escalable)
 * - `DECIMAL_PLACES = 2`: Est√°ndar USD (centavos)
 *
 * @example
 * ```typescript
 * // En formulario:
 * if (concept.length < EXPENSE_VALIDATION.MIN_CONCEPT_LENGTH) {
 *   setError('Descripci√≥n muy corta (m√≠nimo 3 caracteres)');
 * }
 *
 * // En type guard (futuro enhancement):
 * if (expense.concept.length < EXPENSE_VALIDATION.MIN_CONCEPT_LENGTH) {
 *   return false;
 * }
 * ```
 */
export const EXPENSE_VALIDATION = {
  /** Longitud m√≠nima del concepto (3 caracteres) */
  MIN_CONCEPT_LENGTH: 3,

  /** Longitud m√°xima del concepto (100 caracteres) */
  MAX_CONCEPT_LENGTH: 100,

  /** Monto m√≠nimo permitido en USD ($0.01 = 1 centavo) */
  MIN_AMOUNT: 0.01,

  /** Monto m√°ximo permitido en USD ($10,000.00) */
  MAX_AMOUNT: 10000,

  /** N√∫mero de decimales permitidos para montos USD (2 = centavos) */
  DECIMAL_PLACES: 2,
} as const;

/**
 * Mapping de categor√≠as de gastos a emojis visuales para UI y reportes.
 *
 * @remarks
 * Los emojis se usan en:
 * - **UI de gesti√≥n de gastos:** Select de categor√≠as con emojis visuales
 * - **Reporte WhatsApp:** Agrupaci√≥n visual de gastos por categor√≠a
 * - **Alertas visuales:** Identificaci√≥n r√°pida de tipo de gasto
 *
 * **Selecci√≥n de Emojis (v2.5 - Paradise Acuarios):**
 * - üí∞ `employees`: Pagos y adelantos a empleados
 * - üì¶ `supplies`: Insumos operativos (bolsas, materiales)
 * - üîß `maintenance`: Mantenimiento y ferreter√≠a
 * - üöö `shipping`: Env√≠os y encomendistas
 * - üõí `small_purchases`: Compras menores a proveedores
 * - üìã `other`: Clipboard gen√©rico para miscel√°neos
 *
 * @example
 * ```typescript
 * const emoji = EXPENSE_CATEGORY_EMOJI['supplies']; // "üì¶"
 *
 * // En componente React:
 * <Select>
 *   {Object.entries(EXPENSE_CATEGORY_EMOJI).map(([category, emoji]) => (
 *     <option key={category} value={category}>
 *       {emoji} {EXPENSE_CATEGORY_LABEL[category as ExpenseCategory]}
 *     </option>
 *   ))}
 * </Select>
 * ```
 */
// ü§ñ [IA] - v2.5: Emojis actualizados Paradise Acuarios
export const EXPENSE_CATEGORY_EMOJI: Record<ExpenseCategory, string> = {
  employees: 'üí∞',
  supplies: 'üì¶',
  maintenance: 'üîß',
  shipping: 'üöö',
  small_purchases: 'üõí',
  other: 'üìã',
} as const;

/**
 * Mapping de categor√≠as de gastos a labels en espa√±ol para UI.
 *
 * @remarks
 * Labels dise√±ados para:
 * - **Claridad:** Nombres descriptivos que usuarios finales entienden inmediatamente
 * - **Brevedad:** M√°ximo 18 caracteres para caber en UI m√≥vil
 * - **Especificidad:** Adaptados a operaciones Paradise Acuarios
 *
 * **Uso en Componentes:**
 * ```tsx
 * <Select>
 *   {Object.entries(EXPENSE_CATEGORY_LABEL).map(([category, label]) => (
 *     <SelectItem key={category} value={category}>
 *       {EXPENSE_CATEGORY_EMOJI[category as ExpenseCategory]} {label}
 *     </SelectItem>
 *   ))}
 * </Select>
 * ```
 *
 * **Resultado Visual (v2.5):**
 * ```
 * üí∞ Empleados
 * üì¶ Insumos Operativos
 * üîß Mantenimiento
 * üöö Env√≠os
 * üõí Compras Menores
 * üìã Otros
 * ```
 *
 * @example
 * ```typescript
 * const label = EXPENSE_CATEGORY_LABEL['supplies']; // "Insumos Operativos"
 * ```
 */
// ü§ñ [IA] - v2.5: Labels actualizados Paradise Acuarios
export const EXPENSE_CATEGORY_LABEL: Record<ExpenseCategory, string> = {
  employees: 'Empleados',
  supplies: 'Insumos Operativos',
  maintenance: 'Mantenimiento',
  shipping: 'Env√≠os',
  small_purchases: 'Compras Menores',
  other: 'Otros',
} as const;

